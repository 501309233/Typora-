[TOC]



# 文件

## 打开、关闭文件

要以任何方式使用文件的，都必须先用python内置的open函数打开一个文件，创建一个file对象，才能进行后续的读写操作

### open()函数

```python
file object = open(file,mode)
```

参数描述：

* file：是打开文件路径==注意：Windows的路径分隔符要用\\\\或者/，因为反斜杠是转义字符，直接使用会报错==
* mode：打开文件的模式：只读，写入，追加等。该参数非必填，默认为只读（r）

返回值：open()函数返回一个file对象

![1565574230895](E:\Typora笔记\Python\assets\1565574230895.png)

![1565574285880](E:\Typora笔记\Python\assets\1565574285880.png)

### close()方法

 file对象的 close（）方法用来刷新缓冲区里任何还没写入的信息，并关闭该文件之后不能再写入。所以每次打开文件后应该记得一定要用 close（）方法关闭文件

注意：

1. 如果运行程序过程中存在bug导致close()语句未执行，文件将不会关闭。但是未妥善关闭文件可能会导致数据丢失或受损。所以建议将打开文件进行读写操作放在捕获异常的代码中，如果出现异常就执行关闭文件操作。（异常处理在后面课程会学习）
2. 关闭文件必须在使用文件之后，如果在程序中过早的执行close()，当再次需要使用文件时它已关闭，也会导致错误

### with

使用关键字with可以访问文件后自动将其关闭，而不必使用close()方法，使用with关键字打开文件时，一般会使用as关键字为打开的文件对象进行命名

* 使用with的好处：只管打开文件，并在需要时使用它，Python自会在合适时候将其关闭
* 使用with的坏处：在使用with时，open()返回的文件的对象只能在with代码块内可用

![1565574745495](E:\Typora笔记\Python\assets\1565574745495.png)****

## 读取文件

file对象提供了一系列方法，可以使用read()来读取文件

### read()方法

read()方法从一个打开的文件（file对象）中读取字符串，Python字符串可以是二进制数据，而不仅仅是文字

* 打开文件时选择“r”模式，Python将会按照编码格式进行解析，read()操作返回的是str
* 打开文件时选择“rb”模式，read()操作返回的是bytes
* 打开文件时选择"w","a"模式，read()会报错
* 打开文件时选择"w+"模式，read()操作返回空字符串，因为文件被覆盖
* 打开文件时选择"a+"模式，read()操作返回空字符串，因为文件指针被放在文件末尾，读取的内容就是空的

```python
fileObject.read(size)
```

参数：

* size可选参数，从文件开头开始读取字节数，如果没有传入或为负数，就读取到文件末尾，如果文件中有中文，一个中文字表示一个字符，不管其中内部编码是几个字节。读取完之后，光标移动size 个字符。

![1565575143012](assets\1565575143012.png)

### 特别注意

如果像要正确的读取包含中文的文本文件，就要求文本文件的编码与打开文件时设置的编码一致。如果两者没有设置成一致的，在读取时就会出错

![1565575286435](E:\Typora笔记\Python\assets\1565575286435.png)

在Windows中，open方法打开的文件默认为GBK编码，记事本默认使用ANSI编码，在简体中文Windows操作系统中，ANSI编码代表GBK编码，所以在示例4中文件的编码与打开文件的编码是一致的，所以可以正常读取中文

![1565575413025](E:\Typora笔记\Python\assets\1565575413025.png)

上面的两个案例都是以默认的r模式打开文件，如果我们使用二进制的"rb"模式打开文件，read()操作返回的是bytes。如果想要显示文件内容，可以在读取文件内容后使用GBK解码decode("gbk")

![1565580523113](E:\Typora笔记\Python\assets\1565580523113.png)

### 逐行读取

上面示例是一次读取文件的内容，在工作中经常需要检查文件中每一行的内容，这时可使用for循环遍历file对象

![1565580604000](E:\Typora笔记\Python\assets\1565580604000.png)

从上面的结果中可以很明显的看到，打印每一行时都多了空白行

这是因为这个文件中，每行的行尾都有一个看不见的换行符，而print语句也会加上一个换行符，这样就导致每行末尾都会有两个换行符，要消除这些空白行，可以对每一行字符串使用rstrip()方法去掉结尾空白

**![1565580710035](E:\Typora笔记\Python\assets\1565580710035.png)**

逐行读取文件内容，还有更简单的方法：file对象的readline(),readlines()方法

* readline():读取一整行，包括'\n'字符
* readlines():从文件中读取每一行，并将每一行内容存储在一个列表中，这个方法的好处是可以在with代码块之外逐行读取文件内容。

![1565580827440](E:\Typora笔记\Python\assets\1565580827440.png)

![1565580835690](E:\Typora笔记\Python\assets\1565580835690.png)

## 写入文件

file对象提供了一系列方法，可以使用write()方法来写入文件

### write()方法

write()方法可将任何字符串写入一个打开的文件，Python字符串可以是二进制数据，而不是仅仅是文字

* 打开文件时选择"r,rb"只读模式，write()会报错
* 打开文件选择"w,w+,wb,wb+"模式，如果文件存在write()会对其覆盖，如果不存在则新建文件
* 打开文件时选择"a,a+,ab,ab+"模式，write()操作将新的内容写入到已有的内容之后，如果该文件不存在，创建新文件进行写入

需要注意：

1. 如果要写入非字符串类型的数据，需要使用函数str()将其转化为字符串格式
2. write()方法不会在字符串的结尾添加换行符（"\n"），因此写入多行时如果不指定换行符，内容会挤在一起

语法：

```python
fileObject.write(string)
```

![1565581175589](E:\Typora笔记\Python\assets\1565581175589.png)

![1565581213155](E:\Typora笔记\Python\assets\1565581213155.png)

## file对象的属性与常用函数

### file对象的属性

一个文件被打开后，就会有一个file对象，可以通过file对象得到该文件的信息。

file对象相关的属性列表

|    属性     |                  描述                   |
| :---------: | :-------------------------------------: |
| file.closed | 如果文件已被关闭返回true，否则返回false |
|  file.mode  |        返回被打开文件的访问模式         |
|  file.name  |             返回文件的名称              |

![1565581406986](E:\Typora笔记\Python\assets\1565581406986.png)

### file对象的常用函数

前提：file对象需要使用open()方法常见

下表列出了file对象所有常用的函数

| 方法                       | 描述                                                         |
| -------------------------- | ------------------------------------------------------------ |
| file.close()               | 关闭文件                                                     |
| file.flush()               | 刷新文件内部缓冲，直接把内部缓冲区的数据立刻写入文件，而不是被动的等待输出缓冲区写入 |
| file.fileno()              | 返回一个整型的文件描述符(file descriptor FD 整型)，可以用在如os模块的read方法等一些底层操作上 |
| file.isatty()              | 如果文件连接到一个终端设备返回True                           |
| file.next()                | 返回文件下一行                                               |
| file.read([size])          | 从文件读取指定的字节数，默认或为负读取所有                   |
| file.readline([size])      | 读取整行，包括“\n”字符                                       |
| file.readlines([sizeint])  | 读取所有行并返回列表，若给定sizeint>0,返回总和大约为sizeint字节的行，实际读取值可能比sizeint较大，因为需要填充缓冲区 |
| file.seek(offset[,whence]) | 设置文件当前位置                                             |
| file.tell()                | 返回文件当前位置                                             |
| file.truncate([size])      | 截取文件，截取的字节通过size指定，默认为当前文件位置         |
| file.write(str)            | 将字符串写入文件，没有返回值                                 |
| file.writelines(sequence)  | 将文件写入一个序列字符串列表，如果需要换行则要自己加入每行的换行符 |

处理最为常用的读取、写入文件、还有两个常用函数：

1. tell():告诉文件内的当前位置，下一次的读写会从当前位置开始
2. seek(offset[,from]):改变当前文件的位置，seek()函数的参数：
   * offset变量表示要移动的字节数。（一个英文字母部分大小写占一个字节的空间，一个中文汉字占两个字节的空间）
   * from变量指定开始移动字节的参考位置，如果from被设为0，这意味着将文件的开头作为移动字节的参考位置，如果设为1，则使用当前的位置作为参考位置，如果它被设为2，那么该文件的末尾将作为参考位置

![1565582255080](E:\Typora笔记\Python\assets\1565582255080.png)

![1565582267590](E:\Typora笔记\Python\assets\1565582267590.png)

